(function(){if(typeof window.monitor!="undefined")return;var a=function(a,b){var c=document,d=navigator,e=a.screen,f=d.userAgent.toLowerCase(),g={on:function(a,b,c){a.addEventListener?a&&a.addEventListener(b,c,!1):a&&a.attachEvent("on"+b,c)},parentNode:function(a,b,c){c=c||5,b=b.toUpperCase();while(a&&c-->0){if(a.tagName===b)return a;a=a.parentNode}return null}},h={fix:function(a){if(!("target"in a)){var b=a.srcElement||a.target;b&&b.nodeType==3&&(b=b.parentNode),a.target=b}return a}},j=function(){function a(a){return a!=null&&a.constructor!=null?Object.prototype.toString.call(a).slice(8,-1):""}return{isArray:function(b){return a(b)=="Array"},isObject:function(a){return a!==null&&typeof a=="object"},mix:function(a,b,c){for(i in b)if(c||!(a[i]||i in a))a[i]=b[i];return a},encodeURIJson:function(a){var b=[];for(var c in a){if(a[c]==null)continue;b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]))}return b.join("&")}}}(),k={get:function(a){var b,d=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=c.cookie.match(d))?unescape(b[2]):""},set:function(a,b,d){d=d||{};var e=d.expires;typeof e=="number"&&(e=new Date,e.setTime(e.getTime()+d.expires)),c.cookie=a+"="+escape(b)+(e?";expires="+e.toGMTString():"")+(d.path?";path="+d.path:"")+(d.domain?"; domain="+d.domain:"")}},l={getReferrer:function(){return c.referrer},getBrowser:function(){var b={"360se-ua":"360se",TT:"tencenttraveler",Maxthon:"maxthon",GreenBrowser:"greenbrowser",Sogou:"se 1.x / se 2.x",TheWorld:"theworld"};for(i in b)if(f.indexOf(b[i])>-1)return i;var c=!1;try{+external.twGetVersion(external.twGetSecurityID(a)).replace(/\./g,"")>1013&&(c=!0)}catch(d){}if(c)return"360se-noua";var e=f.match(/(msie|chrome|safari|firefox|opera)/);return e=e?e[0]:"",e=="msie"&&(e=f.match(/msie[^;]+/)),e},getLocation:function(){var a="";try{a=location.href}catch(b){a=c.createElement("a"),a.href="",a=a.href}return a=a.replace(/[?#].*$/,""),a=a.replace(/\/$/,"")+"/",a},getGuid:function(){function b(a){var b=0,c=0,d=a.length-1;for(d;d>=0;d--){var e=parseInt(a.charCodeAt(d),10);b=(b<<6&268435455)+e+(e<<14),(c=b&266338304)!=0&&(b^=c>>21)}return b}function g(){var g=[d.appName,d.version,d.language||d.browserLanguage,d.platform,f,e.width,"x",e.height,e.colorDepth,c.referrer].join(""),h=g.length,i=a.history.length;while(i)g+=i--^h++;return(Math.round(Math.random()*2147483647)^b(g))*2147483647}var h="guid",i=k.get(h);return i||(i=[b(c.domain),g(),+(new Date)+Math.random()+Math.random()].join("."),k.set(h,i,{expires:2592e7,path:"/"})),function(){return i}}(),getCount:function(){var a="count",b=k.get(a);return b=(parseInt(b)||0)+1,k.set(a,b,{expires:864e5,path:"/"}),function(){return b}}(),getFlashVer:function(){var b=-1;if(d.plugins&&d.mimeTypes.length){var c=d.plugins["Shockwave Flash"];c&&c.description&&(b=c.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s)+r/,".")+".0")}else if(a.ActiveXObject&&!a.opera)for(var e=16;e>=2;e--)try{var f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+e);if(f){var g=f.GetVariable("$version");b=g.replace(/WIN/g,"").replace(/,/g,".")}}catch(h){}return b=parseInt(b,10),function(){return b}}(),getContainerId:function(a){var b=n.areaIds;if(b){var c,d=","+b.join(",")+",";while(a){if(a.id&&d.indexOf(","+a.id+",")>-1)return a.id;a=a.parentNode}}return""},getText:function(a){return(a.getAttribute("text")||a.innerText||a.textContent||a.title||"").substr(0,100)}},m={getBase:function(){return{u:l.getLocation(),id:l.getGuid(),guid:l.getGuid()}},getTrack:function(){return{b:l.getBrowser(),c:l.getCount(),r:l.getReferrer(),fl:l.getFlashVer()}},getClick:function(a){a=h.fix(a||event);var b=a.target,c=b.tagName,d=l.getContainerId(b);if(b.type!="submit"){if(c=="AREA")return{f:b.href,c:"area:"+b.parentNode.name,cId:d};var m,n;return c=="IMG"&&(m=b),b=g.parentNode(b,"A"),b?(n=l.getText(b),{f:b.href,c:m?m.src.match(/[^\/]+$/):n,cId:d}):!1}var e=g.parentNode(b,"FORM");if(e){var f=e.id||"",i=b.id,j={f:e.action,c:"form:"+(e.name||f),cId:d};if((f=="search-form"||f=="searchForm")&&(i=="searchBtn"||i=="search-btn")){var k=o("kw")||o("search-kw")||o("kw1");j.w=k?k.value:""}return j}},getKeydown:function(a){a=h.fix(a||event);if(a.keyCode!=13)return!1;var b=a.target,c=b.tagName,d=l.getContainerId(b);if(c=="INPUT"){var e=g.parentNode(b,"FORM");if(e){var f=e.id||"",i=b.id,j={f:e.action,c:"form:"+(e.name||f),cId:d};if(i=="kw"||i=="search-kw"||i=="kw1")j.w=b.value;return j}}return!1}},n={trackUrl:null,clickUrl:null,areaIds:null},o=function(a){return document.getElementById(a)};return{util:l,data:m,config:n,sendLog:function(){return a.__monitor_imgs={},function(b){var c="log_"+ +(new Date),d=a.__monitor_imgs[c]=new Image;d.onload=d.onerror=function(){a.__monitor_imgs[c]=null,delete a.__monitor_imgs[c]},d.src=b}}(),buildLog:function(){var a="";return function(b,c){if(b===!1)return;b=b||{};var d=m.getBase();b=j.mix(d,b,!0);var e=j.encodeURIJson(b);if(e==a)return;a=e,setTimeout(function(){a=""},500),e+="&t="+ +(new Date),c=c+"?"+e,this.sendLog(c)}}(),log:function(a,b){b=b||"click";var c=n[b+"Url"];c||alert("Error : the "+b+"url does not exist!"),this.buildLog(a,c)},setConf:function(a,b){var c={};return j.isObject(a)?c=a:c[a]=b,this.config=j.mix(this.config,c,!0),this},setUrl:function(a){return a&&(this.util.getLocation=function(){return a}),this},setId:function(){var a=[],b=0,c;while(c=arguments[b++])j.isArray(c)?a=a.concat(c):a.push(c);return this.setConf("areaIds",a),this},getTrack:function(){var a=this.data.getTrack();return this.log(a,"track"),this},getClickAndKeydown:function(){var a=this;return g.on(c,"click",function(b){var c=a.data.getClick(b);a.log(c,"click")}),g.on(c,"keydown",function(b){var c=a.data.getKeydown(b);a.log(c,"click")}),this}}}(window);a.setConf({trackUrl:"http://haostat.qihoo.com/haopv.gif",clickUrl:"http://haostat.qihoo.com/haoclk.gif",wpoUrl:"http://s.360.cn/hao360/peform.html"}),a.getClickAndKeydown(),window.monitor=a})()